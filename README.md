# Malware-Analysis-Triage
Dissecting and diving into the world of Malware Analysis!

The essential lesson of Malware Analysis is the paramount importance of safety. As I embarked on this course, my initial excitement was tinged with a touch of nervousness. Malware was always something to be avoided but the opportunity to see the inner workings of malware, delving deep into its functionality, and unraveling the mysteries of its behavior is an invaluable learning experience!>

## Introduction:
This blog is about my personal experience learning Malware Analysis and Triage. I am taking a course called "Practical Malware Analysis and Triage" from TCM Security. Out of respect for the course content, I won't detail my entire in depth experience as I feel it's incredibly worth exploring on your own. 

## The Importance of Safety:
- Preventing malware infections on host machines through a healthy paranoid
- Isolated the guest VMs by attaching them to a Host-only Adapter.
- Adjusted IP addresses to avoid conflicts with host IP.
- Ensured that guest VMs could communicate with each other but not with the host.
- Paranoid compulsion to check on adapter settings and pinging before and following malware detonations.
  
![image](https://github.com/CertainRisk/Malware-Analysis-Triage/assets/141761181/6fca6104-ebe3-4d07-9e3c-d9ae58955fac)

## The Setup 
- Created two new VMs: Remnux (Ubuntu) and Flare VM (Windows).
### Flare VM 
  - Flare VM is packed with essential tools for Malware Analysis.
  - Sometimes all the tool packages don't install correctly but they are easy to find online. I had issues with PEView.
  - Notice the internet is showing as not connected - it should never be when detonating malware. Be safe! :)
  
![image](https://github.com/CertainRisk/Malware-Analysis-Triage/assets/141761181/08635546-ca0d-4541-91d3-05f34d3b547f)

### Remnux VM
- Remnux's role in creating a fake internet environment using the terminal command "inetsim".
 - Important to trick malware into thinking it's connected to the internet. Some malware are designed to exit the program and then delete themselves from the disk if they don't detect a domain.

![image](https://github.com/CertainRisk/Malware-Analysis-Triage/assets/141761181/e55fbf56-bc54-4f86-9207-b4f6ecf78101)

# Basic Static Analysis
When it comes to investigating a malware sample, one of the initial steps is Basic Static Analysis. It's like an observation stage where we refrain from running the binary. Drawing conclusions at this point is challenging, as it's merely a surface-level examination.

## The Importance of Documentation

Throughout every phase of malware analysis, meticulous documentation is essential. It serves as a record of every new piece of information you encounter, providing a breadcrumb trail of your progress.

## Dealing with Compressed Samples

Safe malware samples are often compressed and locked within password-protected zip files. To identify these samples, I utilize Cmder, a Console Emulator, to calculate the SHA256 and MD5 checksums of the unzipped but still potentially dangerous sample.

## Leveraging VirusTotal for Insight

Submitting the MD5sum to VirtusTotal.com is a common practice to check if the malware sample has been previously analyzed. In some cases, you'll receive information about the checksum, shedding light on its history.

## Unearthing Clues with Floss

Floss, a tool for extracting strings from binaries, plays a crucial role in malware analysis. These strings can provide valuable clues from within the sample. However, it's essential to remember that strings could also be intentionally placed to mislead analysts.

## Navigating the World of PEView

PEView, short for Portable Executable View, is a tool for inspecting the Portable Executable file format used in Windows. Initially, I encountered installation issues with FlareVM but managed to download it on my host and transfer it to the VM.

While examining a file with PEView, there were aspects I learned to pay attention to:

- **pFile:** The offset of bytes within the file.
- **Value:** The character value representation of bytes.
- **MZ:** Represents a Windows Portable Executable.

## Unveiling Clues in Time/Date Stamp

Under IMAGE FILE HEADER, the Time/Date Stamp might yield useful information. Some malware groups embed specific years in their date stamps, providing insights into the origin of the sample.

## Size Matters: Virtual Size vs. Size of Raw Data

Comparing the Virtual Size and Size of Raw Data is vital. A Virtual Size significantly larger than the Size of Raw Data suggests hidden content within the binary.

## Exploring SECTION .rdata

The IMPORT Address Table within SECTION .rdata can offer valuable information about what the malware is doing or which APIs it's calling.

# Unveiling the Power of PEStudio and CAPA in Malware Analysis

In the fascinating world of malware analysis, tools like PEStudio and CAPA play pivotal roles in uncovering valuable insights hidden within malicious code.

## PEStudio: A Window to Malicious Intent

When you open an armed malware file in PEStudio, you're greeted with a treasure trove of information. From my course experience, I've learned that the 'Indicators' and 'Libraries' sections are among the most crucial areas to explore.

### Libraries: Uncovering Potential Malice

The 'Libraries' section, also known as the 'Blacklist,' reveals libraries that are more likely to be employed maliciously. It's important to note that the presence of these libraries doesn't automatically imply malicious intent; rather, it signifies that they could potentially be misused.

As I delved into this section, I encountered some unfamiliar names that prompted further investigation. To my relief, many of these libraries turned out to be non-malicious. For instance, 'urlmon,' initially puzzling, is an embedded library for OLE32 Extensions for Win32.

Why is this significant? Because OLE (Object Linking and Embedding) can be exploited maliciously, enabling MS Office components to communicate with each other, which is something malware creators often leverage.

## CAPA: Unearthing Malicious Capabilities

CAPA is a remarkable program armed with a set of rules designed to identify malicious capabilities in suspicious programs. It takes a deep dive into binaries, identifying points of interest and asking questions like, "What is that API call doing?" or "Does that string look suspicious?"

CAPA excels at pinpointing aspects related to "downloads, connections, sending, and receiving data." Its keen eye for such details makes it an invaluable asset in malware analysis.

Stay tuned for more insights as we journey deeper into the intricate world of malware analysis, where PEStudio and CAPA continue to reveal the hidden secrets of malicious code.
****

## Malware Behavioral Catalog (MBC): 

Imagine having a playbook like MITRE ATT&CK, but specifically tailored for malware. That's precisely what the Malware Behavioral Catalog (MBC) offers—an indispensable resource in the field of malware analysis.

### CAPA's Glimpse into MBC Behavior

CAPA, as an analytical tool, provides a window into the world of MBC Behavior. It's like deciphering the intentions of malware by examining its behavioral patterns. For instance, in a recent analysis, CAPA informed me that the sample under investigation had the capability to Send and Receive data over HTTP communication. Additionally, it had the ability to create and terminate processes on Windows systems—a red flag indeed.

CAPA  also offers a verbose mode (-v), which unveils even juicier bits of information. Here, you'll find a base address in hexadecimal format, indicating the precise location in the binary where the rule was triggered. This level of granularity can be invaluable in understanding how the malware operates.

### Meet Vivisect: The String and Byte Pattern Extractor

CAPA introduces us to Vivisect—a powerful extractor designed to scrutinize strings and byte patterns. It matches these patterns against predefined rules, helping analysts make sense of complex malware structures.

As we continue to explore the captivating world of malware analysis, MBC, CAPA, and Vivisect remain indispensable tools, shedding light on the sneaky behaviors of malicious code.
